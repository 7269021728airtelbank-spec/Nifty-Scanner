# .github/workflows/scheduler.yml

name: QCS V9.2 Market Scanner

on:
  schedule:
    # ‡§Ø‡§π ‡§π‡§∞ 3 ‡§Æ‡§ø‡§®‡§ü ‡§Æ‡•á‡§Ç ‡§∞‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§ó‡§æ
    - cron: '*/3 * * * *'
  
  # GitHub UI ‡§∏‡•á ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è
  workflow_dispatch:

# üö® IMPORTANT: ‡§Ø‡§π ‡§™‡§ï‡•ç‡§ï‡§æ ‡§ï‡§∞‡•á‡§ó‡§æ ‡§ï‡§ø ‡§è‡§ï ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§π‡•Ä ‡§≤‡•Ç‡§™ ‡§ö‡§≤‡•á
concurrency:
  group: qcs-scanner-group
  cancel-in-progress: true

jobs:
  run_scanner:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 1: Python Environment Setup
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Step 2: Install Python dependencies
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests dhanhq numpy pandas

      # Step 3: Run the QCS Bot Script
      - name: Run the QCS Bot Script
        run: python main.py
        env:
          # --- TELEGRAM SECRETS ---
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          
          # --- JSONBIN SECRETS ---
          JSON_API_KEY: ${{ secrets.JSON_API_KEY }}
          JSON_BIN_ID: ${{ secrets.JSON_BIN_ID }}
          
          # --- DHANHQ SECRETS ---
          DHAN_CLIENT_ID: ${{ secrets.DHAN_CLIENT_ID }}
          DHAN_ACCESS_TOKEN_INITIAL: ${{ secrets.DHAN_ACCESS_TOKEN_INITIAL }}
          DHAN_ENV: ${{ secrets.DHAN_ENV }}
